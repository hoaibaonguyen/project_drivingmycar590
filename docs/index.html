<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Elma: Main Page</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="customdoxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Elma
   </div>
   <div id="projectbrief">An event loop manager for embedded systems</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part --><!-- Generated by Doxygen 1.8.8 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li class="current"><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Enumerations</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Elma Documentation</div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>Simple Car is a final project for ECE590. It will be an event loop and manager process to control the car. The car can be geared up and down. Brake will be applied to the car. It will also have an implementation of the signal lights such as left signal, right signal, and emergency signal.</p>
<h1>Goal </h1>
<p>This project will help me to get more understand on using process and manager as an implementation example of driving a car from speeding up by changing gear, slowing down by pushing brake, and turn left and right using the correct light signal.</p>
<h1>How to run </h1>
<p>The source code for Drive My Car <a href="https://github.com/hoaibaonguyen/project_drivingmycar590.git">is on Github</a>.</p>
<h2>From Dockerhub </h2>
<p>To get started, you will need a C++ build environment. Then following the instruction below </p><pre class="fragment">git clone git clone https://github.com/hoaibaonguyen/project_drivingmycar590.git
cd simpleCar_ECE590
docker run -v $PWD:/source -it klavins/elma:latest bash
make
examples/bin/drivemycar
</pre><h1>Car using Finite State Machines </h1>
<div class="image">
<img src="images/carfinitemachine.png"  width="600"/>
</div>
<p>&lt;/image&gt;</p>
<p>If unable to see the image. Please find the image in folder <a href="https://github.com/hoaibaonguyen/project_drivingmycar590/blob/master/images/carfinitemachine.PNG">images</a></p>
<p>This implementatin will control the car through all automatical step to ensure the car is being droven in the good condition.</p>
<p>```c++ Drive(string name) : StateMachine(name), _check("Check"), _on("On"), _find_station("Find Station"), _fill_gas("Fill Gas"), _drive("Drive"), _off("Off"), _fix("Fix") { set_initial(_check); add_transition("key in", _check, _on); add_transition("star drive", _on, _drive); add_transition("fuel low", _drive, _find_station); add_transition("find gas station", _find_station, _fill_gas); add_transition("fuel full", _fill_gas, _check); add_transition("issue", _drive, _off); add_transition("find issue", _off, _fix); add_transition("issue fixed", _fix, _check); } ```</p>
<h1>Change Gear </h1>
<p>This class will help to get the car into the desired gear. The car will contain 6 speeds. It will turn from 1 to 2 if velocity is greater than the expected or get from 2 to 1 if velocity is decreasing below the expected velocity, etc. This will be contained in function "update" in Gear class</p>
<p>```c++ void update() { if ( channel("Throttle").nonempty() ) { force = channel("Throttle").latest(); }</p>
<p>if (gear == "P" &amp;&amp; brake_on == true &amp;&amp; hand_brake == true){ gear = "1"; brake_on = false; hand_brake = false; start_speed += ( delta() / 1000 ) * ( - k * start_speed + force ) / m; } else if (start_speed &gt;= 10 &amp;&amp; gear == "1" &amp;&amp; brake_on == false &amp;&amp; hand_brake == false){ gear = "2"; start_speed += ( delta() / 1000 ) * ( - k * start_speed + force ) / m; } else if (start_speed &lt; 10 &amp;&amp; gear == "2" &amp;&amp; brake_on == false &amp;&amp; hand_brake == false){ gear = "1"; start_speed += ( delta() / 1000 ) * ( - k * start_speed + force ) / m; } ... start_speed += ( delta() / 1000 ) * ( - k * start_speed + force ) / m; emit(Event("gear", gear)); channel("Velocity").send(start_speed); std::cout &lt;&lt; milli_time() &lt;&lt; "," &lt;&lt; start_speed &lt;&lt; " \n"; } ``` Graph from simulation to show the velocity is incrasing from zero to near max 60 while car is changing gear from 1 to 6. Image can be found &lt;a href="https://github.com/hoaibaonguyen/project_drivingmycar590/blob/master/images/gearup.PNG"&gt;image</p>
<div class="image">
<img src="images/gearup.png"  width="600"/>
</div>
<p>&lt;/image&gt;</p>
<h1>Apply Brake </h1>
<p>This class is designed to bring down the car's speed. It is designed to start at a specific speed. When brake is pushed, velocity will be going down. Also, it will bring back the gear to the initial condition. As the car completely stops, velocity will be down to zero.</p>
<p>```c++ if (brake_on == true ){ if (start_speed &gt; 50){ start_speed += ( delta() / 1000 ) * ( - k * start_speed + force ) / m; gear = "5"; } ... } else { brake_on = true; }</p>
<p>start_speed += ( delta() / 1000 ) * ( - k * start_speed + force ) / m; emit(Event("gear", gear)); channel("Velocity").send(start_speed); std::cout &lt;&lt; milli_time() &lt;&lt; "," &lt;&lt; start_speed &lt;&lt; " \n"; ```</p>
<p>Graph from simulation to show the velocity is decreasing to zero. Image can be found &lt;a href="https://github.com/hoaibaonguyen/project_drivingmycar590/blob/master/images/brake.PNG"&gt;image</p>
<div class="image">
<img src="images/brake.png"  width="600"/>
</div>
<p>&lt;/image&gt;</p>
<h1>Signal Lights </h1>
<p>This class is an implementation of the car lights. It will send the signal to the correct light when driver want to make a turn. Also, when driver finds an issue, an emergency light can also be turned on.</p>
<p>```c++ class SignalOn : public Process { public: SignalOn() : Process("signalon") {} void init() { watch("left on", [this](Event&amp; e) { lefton = true; righton = false; }); watch("right on", [this](Event&amp; e) { lefton = false; righton = true; }); watch("emergency on", [this](Event&amp; e) { lefton = true; righton = true; }); watch("signal off", [this](Event &amp;e) { lefton = false; righton = false; }); watch("light on", [this](Event&amp; e) { light_on_power = e.value(); }); } void start() { lefton = false; righton = false; light_on_power = 0; } void update() {} void stop() {}</p>
<p>bool lefton, righton; double light_on_power; }; ``` The specific of each signal light work can be found in folder <a href="https://github.com/hoaibaonguyen/project_drivingmycar590/tree/master/examples">examples/drivemycar.cc</a></p>
<h1>Improvements </h1>
<p>This project is fun. This is my first time to learn C and C++. There are a lot of things for me to improve in general. To this project, there are still issues that I have faced during running the simulation. Here are some challenges that I need to learn and improve in the future:</p><ul>
<li>Have gear and brake be able to run together.</li>
<li>Design an user interface for driver to select the signal light buttons.</li>
<li>Learn about document the project efficiently</li>
</ul>
<h1>Milestones </h1>
<ul>
<li>Create a change gear class and a way to identify which gear is in (Completed)</li>
<li>Create a State Machine will control the car whether the car is low in fuel or having issue (Complete)</li>
<li>Create a Brake bring the velocity down (Completed)</li>
<li>Create a Signal Lights for left turn, right turn, and emergency (Completed)</li>
<li>Create a simulation test with different environments (Completed)</li>
<li>Documented project with Doxygen (Completed)</li>
<li>Runable with test and submit the project (Upload to GitHub on 3/21) </li>
</ul>
</div></div><!-- contents -->
<!-- start footer part -->
  <hr class="footer"/><address class="footer"><small>
  Developed by <a href="http://klavinslab.org">Eric Klavins</a> for UW ECE P 520<br>
  Generated on Fri Mar 22 2019 05:11:18 for Elma by &#160;<a href="http://www.doxygen.org/index.html">
  Doxygen
  </a> 1.8.8
  </small></address>
  </body>
  </html>